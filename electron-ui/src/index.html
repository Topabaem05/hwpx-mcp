<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Open WebUI Clone</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              zinc: {
                850: "#27272a",
                900: "#18181b",
                950: "#09090b",
              },
            },
            fontFamily: {
              sans: [
                "Pretendard",
                "-apple-system",
                "BlinkMacSystemFont",
                "system-ui",
                "Roboto",
                "Helvetica Neue",
                "Segoe UI",
                "Apple SD Gothic Neo",
                "Noto Sans KR",
                "Malgun Gothic",
                "sans-serif",
              ],
            },
          },
        },
      };
    </script>
    <style>
      @import url("https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css");

      body {
        font-family: "Pretendard", sans-serif;
      }

      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      ::-webkit-scrollbar-track {
        background: transparent;
      }

      ::-webkit-scrollbar-thumb {
        background: #3f3f46;
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #52525b;
      }

      textarea {
        scrollbar-width: none;
      }

      textarea::-webkit-scrollbar {
        display: none;
      }

      .typing-dot {
        animation: typing 1.4s infinite ease-in-out both;
      }

      .typing-dot:nth-child(1) {
        animation-delay: -0.32s;
      }

      .typing-dot:nth-child(2) {
        animation-delay: -0.16s;
      }

      @keyframes typing {
        0%,
        80%,
        100% {
          transform: scale(0);
        }
        40% {
          transform: scale(1);
        }
      }
    </style>
  </head>
  <body class="bg-zinc-900 text-zinc-100 h-screen flex overflow-hidden selection:bg-zinc-700 selection:text-white">
    <div id="sidebar-overlay" class="fixed inset-0 bg-black/50 z-20 hidden lg:hidden"></div>

    <aside
      id="sidebar"
      class="fixed lg:relative z-30 w-64 h-full bg-zinc-950 flex flex-col transition-transform duration-300 transform -translate-x-full lg:translate-x-0 border-r border-zinc-800"
    >
      <div class="p-3 flex items-center justify-between">
        <button
          id="newSession"
          class="flex-1 flex items-center gap-2 hover:bg-zinc-800/50 p-2 rounded-xl transition-colors text-sm font-medium"
        >
          <div class="w-6 h-6 rounded-full bg-white text-black flex items-center justify-center">
            <i data-lucide="plus" class="w-4 h-4"></i>
          </div>
          새 채팅
        </button>
        <button
          id="closeSidebar"
          class="p-2 text-zinc-400 hover:text-white hover:bg-zinc-800/50 rounded-xl transition-colors lg:hidden"
        >
          <i data-lucide="x" class="w-5 h-5"></i>
        </button>
      </div>

      <div class="flex-1 overflow-y-auto px-3 py-2 space-y-6">
        <div>
          <h3 class="text-xs font-semibold text-zinc-500 mb-2 px-2">대화</h3>
          <ul id="sessionList" class="space-y-0.5"></ul>
        </div>
      </div>

      <div class="p-3 border-t border-zinc-800">
        <button
          id="openSettingsBtn"
          class="w-full flex items-center gap-3 p-2 hover:bg-zinc-800/50 rounded-xl transition-colors"
        >
          <div
            class="w-8 h-8 rounded-full bg-gradient-to-tr from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold text-sm"
          >
            U
          </div>
          <div class="flex-1 text-left">
            <div class="text-sm font-medium text-white">User</div>
          </div>
          <i data-lucide="settings" class="w-4 h-4 text-zinc-400"></i>
        </button>
      </div>
    </aside>

    <main class="flex-1 flex flex-col relative min-w-0">
      <header class="h-14 flex items-center justify-between px-4 absolute top-0 left-0 right-0 z-10 bg-zinc-900/80 backdrop-blur-md">
        <div class="flex items-center gap-2">
          <button
            id="sidebarToggle"
            class="p-2 text-zinc-400 hover:text-white rounded-lg transition-colors lg:hidden"
          >
            <i data-lucide="menu" class="w-5 h-5"></i>
          </button>
          <button
            id="chatTitle"
            class="flex items-center gap-2 text-lg font-semibold text-zinc-200 hover:text-white px-2 py-1 rounded-lg hover:bg-zinc-800 transition-colors"
          >
            OpenAI (gpt-4o-mini)
            <i data-lucide="chevron-down" class="w-4 h-4 text-zinc-500"></i>
          </button>
        </div>
        <div class="flex items-center gap-2">
          <button id="openSettingsHeaderBtn" class="p-2 text-zinc-400 hover:text-white rounded-lg transition-colors" title="Settings">
            <i data-lucide="sliders-horizontal" class="w-5 h-5"></i>
          </button>
        </div>
      </header>

      <div id="chat-container" class="flex-1 overflow-y-auto pt-16 pb-36 px-4 md:px-8 scroll-smooth">
        <div class="max-w-3xl mx-auto flex flex-col gap-6" id="chat-box">
          <div id="welcome-screen" class="flex flex-col items-center justify-center h-[60vh] text-center mt-10">
            <div class="w-16 h-16 rounded-2xl bg-white text-black flex items-center justify-center mb-6 shadow-xl">
              <i data-lucide="bot" class="w-10 h-10"></i>
            </div>
            <h1 class="text-3xl font-bold text-white mb-2">무엇을 도와드릴까요?</h1>
            <p class="text-zinc-400 text-sm mb-8">OpenAI OAuth 기반으로 문서 작업을 시작해보세요.</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 w-full max-w-2xl">
              <button class="suggestion-prompt text-left p-4 rounded-2xl border border-zinc-800 bg-zinc-850/50 hover:bg-zinc-800 transition-colors group" data-prompt="전자상거래 쇼핑몰 초기 기획서를 작성해줘">
                <h4 class="text-sm font-medium text-zinc-200 group-hover:text-blue-400 transition-colors">웹사이트 기획서 작성하기</h4>
                <p class="text-xs text-zinc-500 mt-1">전자상거래 쇼핑몰을 위한 초기 기획서</p>
              </button>
              <button class="suggestion-prompt text-left p-4 rounded-2xl border border-zinc-800 bg-zinc-850/50 hover:bg-zinc-800 transition-colors group" data-prompt="파이썬 데이터 처리 스크립트를 리뷰해줘">
                <h4 class="text-sm font-medium text-zinc-200 group-hover:text-green-400 transition-colors">파이썬 코드 리뷰</h4>
                <p class="text-xs text-zinc-500 mt-1">작성한 스크립트의 성능 개선점 찾기</p>
              </button>
              <button class="suggestion-prompt text-left p-4 rounded-2xl border border-zinc-800 bg-zinc-850/50 hover:bg-zinc-800 transition-colors group hidden md:block" data-prompt="인공지능이 지배하는 미래 도시 배경으로 SF 소설 시놉시스를 써줘">
                <h4 class="text-sm font-medium text-zinc-200 group-hover:text-purple-400 transition-colors">SF 소설 시놉시스</h4>
                <p class="text-xs text-zinc-500 mt-1">인공지능이 지배하는 미래 도시 배경</p>
              </button>
              <button class="suggestion-prompt text-left p-4 rounded-2xl border border-zinc-800 bg-zinc-850/50 hover:bg-zinc-800 transition-colors group hidden md:block" data-prompt="프론트엔드 주니어 면접 예상 질문 10개를 만들어줘">
                <h4 class="text-sm font-medium text-zinc-200 group-hover:text-yellow-400 transition-colors">면접 예상 질문</h4>
                <p class="text-xs text-zinc-500 mt-1">프론트엔드 개발자 주니어 포지션</p>
              </button>
            </div>
          </div>

          <div id="message-list" class="flex flex-col gap-6"></div>
        </div>
      </div>

      <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-zinc-900 via-zinc-900 to-transparent pt-6 pb-6 px-4 md:px-8">
        <div class="max-w-3xl mx-auto relative">
          <form id="chatForm" class="bg-zinc-800 border border-zinc-700 rounded-3xl p-2 flex items-end shadow-2xl transition-all focus-within:border-zinc-500 focus-within:ring-4 focus-within:ring-zinc-800/50">
            <button type="button" class="p-3 text-zinc-400 hover:text-white hover:bg-zinc-700 rounded-full transition-colors flex-shrink-0">
              <i data-lucide="paperclip" class="w-5 h-5"></i>
            </button>

            <textarea
              id="message-input"
              class="w-full bg-transparent text-white px-2 py-3 max-h-48 resize-none outline-none text-base"
              rows="1"
              placeholder="메시지를 입력하세요... (Shift + Enter로 줄바꿈)"
            ></textarea>

            <button id="send-btn" type="submit" class="p-2 mb-1 mr-1 bg-zinc-700 text-zinc-400 rounded-full transition-all duration-200 flex-shrink-0 disabled:opacity-50">
              <div class="w-8 h-8 flex items-center justify-center rounded-full bg-inherit text-inherit">
                <i data-lucide="arrow-up" class="w-5 h-5"></i>
              </div>
            </button>
          </form>
          <div class="text-center text-xs text-zinc-500 mt-3">AI는 실수를 할 수 있습니다. 중요한 정보는 확인하세요.</div>
        </div>
      </div>
    </main>

    <div id="settingsModal" class="fixed inset-0 z-40 hidden">
      <div id="settingsOverlay" class="absolute inset-0 bg-black/60"></div>
      <div class="relative z-10 h-full w-full flex items-center justify-center p-4">
        <section class="w-full max-w-lg bg-zinc-900 border border-zinc-700 rounded-2xl shadow-2xl p-5 space-y-4">
          <div class="flex items-center justify-between">
            <h2 class="text-lg font-semibold text-white">설정</h2>
            <button id="closeSettingsBtn" class="p-2 text-zinc-400 hover:text-white rounded-lg hover:bg-zinc-800 transition-colors">
              <i data-lucide="x" class="w-5 h-5"></i>
            </button>
          </div>

          <div class="space-y-2">
            <label class="text-xs text-zinc-400" for="backendBaseUrlInput">Backend URL</label>
            <input id="backendBaseUrlInput" type="url" class="w-full rounded-xl bg-zinc-850 border border-zinc-700 px-3 py-2 text-sm text-zinc-100 outline-none focus:border-zinc-500" placeholder="http://127.0.0.1:8000" />
          </div>

          <div class="space-y-2">
            <label class="text-xs text-zinc-400" for="openaiApiKeyInput">OpenAI API Key (Fallback)</label>
            <input id="openaiApiKeyInput" type="password" class="w-full rounded-xl bg-zinc-850 border border-zinc-700 px-3 py-2 text-sm text-zinc-100 outline-none focus:border-zinc-500" placeholder="sk-..." />
          </div>

          <div class="space-y-2">
            <label class="text-xs text-zinc-400" for="gptOauthTokenInput">GPT OAuth Token</label>
            <input id="gptOauthTokenInput" type="password" class="w-full rounded-xl bg-zinc-850 border border-zinc-700 px-3 py-2 text-sm text-zinc-100 outline-none focus:border-zinc-500" placeholder="OAuth token" />
          </div>

          <button id="openAiOauthLoginBtn" class="w-full rounded-xl border border-zinc-700 bg-zinc-800 px-3 py-2 text-sm text-zinc-100 hover:bg-zinc-700 transition-colors">
            OpenAI OAuth 로그인
          </button>

          <div id="oauthCodePanel" class="hidden rounded-xl border border-zinc-700 bg-zinc-850 px-3 py-3 space-y-2">
            <p class="text-xs text-zinc-400">인증 코드</p>
            <div id="oauthUserCode" class="text-base font-semibold tracking-[0.2em] text-zinc-100">-</div>
            <p id="oauthManualHint" class="text-xs text-zinc-400">
              브라우저에서 위 코드를 입력해 로그인하세요.
            </p>
            <div class="grid grid-cols-2 gap-2">
              <button id="oauthCopyCodeBtn" class="rounded-lg border border-zinc-700 bg-zinc-800 px-2 py-1.5 text-xs text-zinc-100 hover:bg-zinc-700 transition-colors">
                코드 복사
              </button>
              <button id="oauthOpenLinkBtn" class="rounded-lg border border-zinc-700 bg-zinc-800 px-2 py-1.5 text-xs text-zinc-100 hover:bg-zinc-700 transition-colors">
                인증 페이지 열기
              </button>
            </div>
          </div>

          <div class="grid grid-cols-2 gap-2">
            <button id="saveSettings" class="rounded-xl bg-white text-black px-3 py-2 text-sm font-medium hover:bg-zinc-200 transition-colors">저장</button>
            <button id="resetSettings" class="rounded-xl border border-zinc-700 bg-zinc-800 text-zinc-100 px-3 py-2 text-sm hover:bg-zinc-700 transition-colors">초기화</button>
          </div>

          <div class="grid grid-cols-2 gap-2">
            <button id="checkGateway" class="rounded-xl border border-zinc-700 bg-zinc-800 text-zinc-100 px-3 py-2 text-sm hover:bg-zinc-700 transition-colors">상태 확인</button>
            <button id="restartBackend" class="rounded-xl border border-zinc-700 bg-zinc-800 text-zinc-100 px-3 py-2 text-sm hover:bg-zinc-700 transition-colors">백엔드 재시작</button>
          </div>

          <p id="statusText" class="text-xs text-zinc-400 min-h-[1.25rem]">Ready</p>
        </section>
      </div>
    </div>

    <script type="module" src="renderer.js"></script>
  </body>
</html>
